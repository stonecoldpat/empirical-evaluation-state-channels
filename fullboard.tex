\section{Full Board Extension} \label{sec:commitmentcell}

We present an extension to our battleship game which requires a commitment for every cell of the board in addition to the ship commitments. 
For each cell, the commitment consists of a flag $b$ indicating if it is occupied by water $b := 0$ or a ship $b := 1$, and a randon nonce $r$. 
Assuming the selected board is well-formed, then it can prevent each player lying about their cell opening during the game, but it also increases the game state and the gas requirement for each move in the game. 


\subsection{Modifications to the Battleship Contract} 

We present how to modify the battleship contract to support the full board extension. 
This requires modifying how the game is prepared, how a cell opening during the game play is verified by the contract and how the full board is opened at the game's end. 

\paragraph{Prepare boards}
%Both parties still participate in a cut-and-choose protocol during $\gamestatus := \gamesetup$ and compute $n$ lists of ship hashes. 
Our extension requires each party to compute an entire board to accompany a list of ships.   
The board is a list of cell hashes such that $\hcell_{1,1},...,\hcell_{n,n}$ where $n,n$ is the final grid co-ordinate. 
A cell hash is $\hash(b, r, \mathsf{round}, \participant, \appcontract)$, where $b$ is a flag indicating if it is occupied by water $b := 0$ or a ship location $b := 1$, and $r$ is the nonce. 
The party signs the list of ships and the board cells: 

\begin{displaymath}
 \sigma := \sign_{\participant}(((k_{1},\hship_{1}),...,(k_{n},\hship_{n})), (\hcell_{1,1},...,\hcell_{n,n}), \participant, \mathsf{round}, \appcontract)
\end{displaymath}
 
The contract stores every cell hash in the contract for future use. 
Each party is responsible for reserving the list of ship and its the board on behalf of their counterparty using  $\battleshipselectboard$. 
All remaining $N-1$ list of ships and their corresponding boards must be opened and reviewed by the counterparty.  
If satisified, each party notifies the contract to begin the game using $\battleshipbegin$ or they can quit using $\battleshipgameover$.
The above can be used as part of the cut-and-choose protocol proposed for the original contract. 
%Finally the game $\mathsf{round}$ is incremented regardless if it continues or not. 

\paragraph{Game-play}
Our extension requires modifying how a player responds to an attacked cell:

\begin{center}
	$\sigma^{hit}_{\participant} := \sign_{\participant}(x,y,b, r_{cell},\mathsf{move}, \mathsf{round},\appcontract)$ \\ $\sigma^{sunk}_{\participant} := \sign_{\participant}(x,y,x\pm,y\pm,r_{cell}, r_{ship},\hship,\mathsf{move}, \mathsf{round},\appcontract)$
\end{center}

Both the hit and sunk messages include the nonce $r_{cell}$.
This lets the contract open $\hcell_{x,y}$ and confirm that the supplied $b$ matches the commitment during the setup.
The opening can be stored by the contract, otherwise each party must keep a copy of every signed message\footnote{Every signed message is emitted by the contract and thus it is easily fetchable.} for future fraud proofs as presented in Section \ref{sec:prooffraud}.


\subsection{Changes to Fraud Detection}

We present the additional fraud detection that is performed by the contract and the player due to the extension. 

\paragraph{Integrity checks} 

As presented in Section~\ref{sec:fraud} the contract checks all signed messages received to self-enforce the game's correct execution. 
Our extension requires the contract to check every cell opening with the stored cell hash $\hcell$. 


%Our extension 
%In addition to the integrity checks presented in Section~\ref{sec:fraud} (\emph{Exceeded maximum number of moves}, \emph{Players only play using valid cells}, \emph{A ship was not placed horizontally or vertically}) that are performed in the same way, the cell commitments also allow checking for \emph{False Cell Reveal}, i.e. the contract ensures that a player cannot claim that a cell contains water if it in fact contains a ship by checking that the reveal matches the cell commitment (as described above). This allows ending a game early if a player tries to cheat by revealing false information about a cell. In our main version without cell commitments this could only be detected and punished at the end of the game.

\paragraph{Proof of fraud} 
If we assume the board is well-formed upon set up, then the party cannot be dishonest about their cell opening during the game. 
The fraud proofs $\battleshipdeclarednothit$ or $\battleshipdeclarednotwater$ are still required as the board used in the game can be invalid and the contract must verify that the cell opening does not correspond to a ship opening. 
There is no change to the fraud proof except that the cell nonces are submitted to the contract alongside the signed cell openings. 